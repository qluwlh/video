(this["webpackJsonpmy-video-app"]=this["webpackJsonpmy-video-app"]||[]).push([[0],{52:function(e,n,t){},54:function(e,n,t){},80:function(e,n,t){"use strict";t.r(n);var c=t(7),r=t.n(c),a=t(43),o=t.n(a),i=(t(52),t(30)),u=t.n(i),s=t(44),l=t(18),d=t(47),b=(t(54),t(31)),j=t.n(b),f=t(90),p=t(89),m=t(87),v=t(26),O=t(88),h=t(84),g=t(85),y=t(86),x=t(17),k=t.n(x),w=t(2),E=t(81),R=t(79),_={static:"https://static.uskid.com/playback/20200523/qn5w3mn75/2_6gr4jM07dBixDv4D.m3u8","oss-accelerate":"https://uskid.oss-accelerate.aliyuncs.com/playback/20200523/qn5w3mn75/2_6gr4jM07dBixDv4D.m3u8","oss-cn-beijing":"https://uskid.oss-cn-beijing.aliyuncs.com/playback/20200523/qn5w3mn75/2_6gr4jM07dBixDv4D.m3u8"},S={test:"https://hq-static.oss-cn-beijing.aliyuncs.com/videoTest/fragmented.mp4",static:"https://static.uskid.com/playback/20200523/qn5w3mn75/2_0_merge_av.mp4","oss-accelerate":"https://uskid.oss-accelerate.aliyuncs.com/playback/20200523/qn5w3mn75/2_0_merge_av.mp4","oss-cn-beijing":"https://uskid.oss-cn-beijing.aliyuncs.com/playback/20200523/qn5w3mn75/2_0_merge_av.mp4"},L=function(e){return Object(f.a)((function(){return j.a.get(e,{responseType:"arraybuffer"})})).pipe(Object(v.a)((function(e){return e.data})),Object(g.a)(10))};var C=function(){var e=Object(c.useState)(!1),n=Object(l.a)(e,2),t=n[0],r=n[1],a=Object(c.useState)(""),o=Object(l.a)(a,2),i=o[0],b=o[1],g=Object(c.useState)(""),x=Object(l.a)(g,2),C=x[0],M=x[1],D=Object(c.useMemo)((function(){return new R.mp4.Transmuxer}),[]),T=Object(c.useMemo)((function(){return new MediaSource}),[]),B=Object(c.useRef)(null),q=Object(c.useRef)(null),U=function(){var e;T.endOfStream(),null===(e=q.current)||void 0===e||e.play(),r(!0)},A=function(){var e=Object(s.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:q.current&&URL.revokeObjectURL(q.current.src),B.current=T.addSourceBuffer('video/mp4; codecs="mp4a.40.2,avc1.64001f"'),D.on("data",(function(e){console.log('transmuxer.on("data"',e);var n=new Uint8Array(e.initSegment.byteLength+e.data.byteLength);n.set(e.initSegment,0),n.set(e.data,e.initSegment.byteLength),console.log(R.mp4.tools.inspect(n)),B.current.addEventListener("updateend",U),B.current.appendBuffer(n)}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(c.useEffect)((function(){q.current&&(q.current.src=URL.createObjectURL(T)),T.addEventListener("sourceopen",A)}),[]);var F=function(e){return function(n){var t,c,r,a=null!==(t=null===(c=e.match(/(.*)\/.*.m3u8$/))||void 0===c?void 0:c[1])&&void 0!==t?t:"";(r=function(e,n){var t=new E.Parser;return t.push(e),t.end(),t.manifest.segments.map((function(e){return e.uri})).map((function(e){return"".concat(n,"/").concat(e)}))}(n,a),Object(p.a)(r).pipe(Object(y.a)((function(e){return m.a.apply(void 0,Object(d.a)(e.map((function(e){return L(e).pipe(Object(v.a)((function(e){return new Uint8Array(e)})))}))))})),Object(h.a)((function(e){return Object(p.a)({error:!0,message:e.message})})))).subscribe({next:function(e){console.log("segments$.subscribe-item",e),(null===e||void 0===e?void 0:e.length)&&(e.forEach((function(e){return D.push(e)})),D.flush())},error:console.log,complete:function(){return console.log("segments-done")}})}};return Object(w.jsxs)("div",{className:"root",children:[Object(w.jsxs)("div",{children:[Object(w.jsx)("button",{onClick:function(){var e=new k.a({maxBufferLength:1800});e.on(k.a.Events.MANIFEST_PARSED,(function(){var e;r(!0),null===(e=q.current)||void 0===e||e.play()})),e.on(k.a.Events.ERROR,(function(n,t){if(t.fatal)switch(t.type){case k.a.ErrorTypes.NETWORK_ERROR:console.log("fatal network error encountered, try to recover"),e.startLoad();break;case k.a.ErrorTypes.MEDIA_ERROR:console.log("fatal media error encountered, try to recover"),e.recoverMediaError();break;default:e.destroy()}})),e.loadSource(_[i]),e.attachMedia(q.current)},children:"\u8fb9\u64ad\u653e\u8fb9\u9884\u52a0\u8f7d"}),Object(w.jsxs)("div",{children:[Object(w.jsxs)("select",{name:i,id:i,onChange:function(e){return b(e.target.value)},children:[Object(w.jsx)("option",{value:"",children:"\u9009\u62e9"},""),Object.entries(_).map((function(e){var n=Object(l.a)(e,2),t=n[0],c=n[1];return Object(w.jsx)("option",{value:t,children:c},t)}))]}),Object(w.jsx)("button",{onClick:function(){var e=_[i];(function(e){return Object(f.a)((function(){return j.a.get(e)})).pipe(Object(v.a)((function(e){return e.data})),Object(O.a)((function(e){return e})),Object(h.a)((function(e){return Object(p.a)({error:!0,message:e.message})})))})(e).subscribe({next:F(e),complete:function(){return console.log("data-done")}})},disabled:!i,children:"\u83b7\u53d6m3u8"})]}),Object(w.jsxs)("div",{children:[Object(w.jsxs)("select",{name:C,id:C,onChange:function(e){return M(e.target.value)},children:[Object(w.jsx)("option",{value:"",children:"\u9009\u62e9"},""),Object.entries(S).map((function(e){var n=Object(l.a)(e,2),t=n[0],c=n[1];return Object(w.jsx)("option",{value:t,children:c},t)}))]}),Object(w.jsx)("button",{onClick:function(){L(S[C]).pipe(Object(v.a)((function(e){return new Uint8Array(e)}))).subscribe({next:function(e){console.log("mp4-url",e),D.push(e),D.flush()}})},disabled:!C,children:"\u83b7\u53d6mp4"})]})]}),Object(w.jsx)("div",{children:Object(w.jsx)("video",{id:"video",width:400,height:300,className:"video",controls:!0,ref:q,onCanPlay:function(){}})}),t&&Object(w.jsxs)("div",{children:[Object(w.jsx)("button",{onClick:function(){var e;return null===(e=q.current)||void 0===e?void 0:e.play()},children:"\u64ad\u653e"}),Object(w.jsx)("button",{onClick:function(){var e;return null===(e=q.current)||void 0===e?void 0:e.pause()},children:"\u6682\u505c"})]})]})},M=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,91)).then((function(n){var t=n.getCLS,c=n.getFID,r=n.getFCP,a=n.getLCP,o=n.getTTFB;t(e),c(e),r(e),a(e),o(e)}))};o.a.render(Object(w.jsx)(r.a.StrictMode,{children:Object(w.jsx)(C,{})}),document.getElementById("root")),M()}},[[80,1,2]]]);
//# sourceMappingURL=main.67b2c19b.chunk.js.map